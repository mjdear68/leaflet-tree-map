---
title: "Felicity's Tree Girth Project"
author: "Michael Dear"
date: "2025-07-20"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction
The girths of 30 trees were measured in the Campbell Rhododendron Gardens, Blackheath, NSW. The measurements were made 1.4m from ground level and were recorded in centimetres. Photographs containing GPS and other ancilliary information were taken of each tree.

## Objective
The objectives (OB) of this analysis are to:

1. create an interactive map showing the location of each tree with the girth of each tree displayed as a roll-over popup
2. produce a boxplot and histogram of the girth measurements
3. provide a quantitative summary table of the girth measurements.

## References

* https://www.r-bloggers.com/2016/11/extracting-exif-data-from-photos-using-r/ for the basic concept.
* https://youtu.be/TZ8CxNNHiUU?si=qBd84kY_Ep0JwaiS for creating maps using `sf` and `leaflet`.
* https://rstudio.github.io/leaflet/index.html for `leaflet` examples.

# Preparation
## Libraries etc
```{r Libraries etc}
# Clear the environment
rm(list=ls())

library(exiftoolr) # To extract EXIF information from photos; Need to run 'install_exiftoolr()' from R command line after install.packages('exiftoolr')
library(dplyr)
library(sf) # For making geospatial data frames
library(leaflet) # For making interactive maps
library(htmltools) # For map popups
```


## Import and Prepare the Data
```{r Import and Prepare the Data}
files <- list.files("./Input/Tree Photos", pattern = "*.JPG")
df_base <- exif_read(paste("./Input/Tree Photos/", files, sep="")) 
```

```{r Merge tree girths}
df_base <- read.csv("Input/tree_girths.csv") |> 
                      select(Girth_mm) |>
                      cbind(df_base)
```


```{r create sf object}
df_map <- df_base |> 
  select(FileName, DateTimeOriginal, Girth_mm, GPSLatitude, GPSLongitude) |> 
  st_as_sf(coords = c("GPSLongitude","GPSLatitude"), remove = FALSE, crs = 4326)
```


## OB 1
```{r continuous colour palette}
# Create a continuous palette function
# https://rstudio.github.io/leaflet/articles/colors.html
# https://colorbrewer2.org/#type=sequential&scheme=RdPu&n=3
pal <- colorNumeric(
  palette = "RdPu",
  domain = df_map$Girth_mm)
```

```{r Interactive Map}

m <- leaflet(elementId = "Trees", options = leafletOptions(minZoom = 15, maxZoom = 20)) |>
  # Tiles
  addTiles(group = "OSM (default)") |> # Gives Open Street Map tiles 
  addProviderTiles(providers$CartoDB.Positron, group = "Positron (minimal)") |>
   addProviderTiles(providers$Esri.WorldImagery, group = "World Imagery (satellite)") |>
  setView(150.2864, -33.6268, zoom = 18) |>
  
  # Markers
  addCircleMarkers(data = df_map, 
                   popup = ~htmlEscape(paste("Girth: ", Girth_mm, "mm", sep = "")), 
                   radius = ~sqrt(Girth_mm)*0.1, 
                   color = ~pal(Girth_mm),
                   group = "Trees") |>
  
  # Controls
   addLayersControl(
    baseGroups = c(
      "OSM (default)",
      "Positron (minimal)",
      "World Imagery (satellite)"
    ),
    overlayGroups = c("Trees"),
    options = layersControlOptions(collapsed = FALSE)
  )

m
```

```{r}
leaflet() |> addProviderTiles(providers$Esri.WorldImagery)
```


## OB 2

## OB 3
